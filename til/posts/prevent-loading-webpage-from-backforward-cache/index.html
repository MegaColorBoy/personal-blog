<!DOCTYPE html>
<html data-theme="" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="author" content="Abdush Shakoor">
	<title>Prevent loading a webpage from Back-Forward cache | megacolorboy</title>

	
	<meta name="description" content="I'm working on an eCommerce project and I encountered a really weird problem, whenever I saved items into my cart and proceed to the checkout page and then go back to previous page, my cart isn't updated until I refresh the page.Honestly, I thought this was a bug until I came around to learn about Back-Forward Caching a.k.a bfcache, which allows the user to navigate between pages faster. That's a good thing, though!But that didn't help resolve my issue, so I thought of going around with a tiny hack:The code above will look any persistence of the  event. Initially, it's set to  and if the page is loaded from bfcache, it'll set to .I wouldn't really consider this as a solution as it only worked on Safari instead of Chrome or Firefox.But hey, it gets the job done! ðŸ˜‚.">
	<meta name="og:title" content="Prevent loading a webpage from Back-Forward cache | megacolorboy" />
	<meta name="og:type" content="article" />
	<meta name="og:url" content="https://www.megacolorboy.com/posts/prevent-loading-webpage-from-backforward-cache/" />
	<meta name="og:description" content="I'm working on an eCommerce project and I encountered a really weird problem, whenever I saved items into my cart and proceed to the checkout page and then go back to previous page, my cart isn't updated until I refresh the page.Honestly, I thought this was a bug until I came around to learn about Back-Forward Caching a.k.a bfcache, which allows the user to navigate between pages faster. That's a good thing, though!But that didn't help resolve my issue, so I thought of going around with a tiny hack:The code above will look any persistence of the  event. Initially, it's set to  and if the page is loaded from bfcache, it'll set to .I wouldn't really consider this as a solution as it only worked on Safari instead of Chrome or Firefox.But hey, it gets the job done! ðŸ˜‚" />
	<meta name="og:site_name" content="Abdush Shakoor's Blog | megacolorboy" />
	
	
	<link rel="stylesheet" href="/static/css/main.css" type="text/css">
	<link id="syntaxHighlight" rel="stylesheet" href="/static/vendor/hljs/css/github.min.css">
	<link href="/static/favicon.ico" rel="shortcut icon" type="image/x-icon"/>
	
	<script src="https://unpkg.com/phosphor-icons"></script>
	<!-- Add OG tags  -->

	<script>
		if(localStorage.theme){
			document.documentElement.setAttribute('data-theme', localStorage.getItem("theme"));
		}
	</script>

</head>
<body class="details-page til">
	<!-- Navbar -->
	<header class="header">
	<div class="author">
		<a href="/">
			<div class="logo" style="background-image: url('../static/logo.gif');"></div>
			<p>megacolorboy</p>
		</a>
	</div>
	<div class="nav-mobile"><a id="navbar-toggle" href="#!"><span></span></a></div>
	<nav>
		<ul class="menu">
			
				<li><a href="/about">About</a></li>
			
				<li><a href="/writings">Writings</a></li>
			
				<li><a href="/til">Today I Learned</a></li>
			
				<li><a href="/resume">Resume</a></li>
			
		</ul>
	</nav>
</header>

<div class="article-top">
	<a class="back" href="/til"><span>&larr;</span> Back</a>
	<p class="date">Published on August 30th, 2020</p>	
</div>

<main>
	<section class="article-head">
		<p class="cat">JavaScript</p>
		<h1>Prevent loading a webpage from Back-Forward cache</h1>
		
			<p class="desc">I'm working on an eCommerce project and I encountered a really weird problem, whenever I saved items into my cart and proceed to the checkout page and then go back to previous page, my cart isn't updated until I refresh the page.Honestly, I thought this was a bug until I came around to learn about Back-Forward Caching a.k.a bfcache, which allows the user to navigate between pages faster. That's a good thing, though!But that didn't help resolve my issue, so I thought of going around with a tiny hack:The code above will look any persistence of the  event. Initially, it's set to  and if the page is loaded from bfcache, it'll set to .I wouldn't really consider this as a solution as it only worked on Safari instead of Chrome or Firefox.But hey, it gets the job done! ðŸ˜‚</p>
		
		<p class="date">1 minute read</p>
	</section>
	<article>
		<p>I'm working on an eCommerce project and I encountered a really weird problem, whenever I saved items into my cart and proceed to the checkout page and then go back to previous page, my cart isn't updated until I refresh the page.</p>

<p>Honestly, I thought this was a bug until I came around to learn about <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Firefox/Releases/1.5/Using_Firefox_1.5_caching">Back-Forward Caching</a> a.k.a <strong>bfcache</strong>, which allows the user to navigate between pages faster. That's a good thing, though!</p>

<p>But that didn't help resolve my issue, so I thought of going around with a tiny hack:</p>

<pre>
<code class="js">
window.onpageshow = function(event) {
    if (event.persisted) {
        window.location.reload() 
    }
};
</code>
</pre>

<p>The code above will look any persistence of the <code>onpageshow</code> event. Initially, it's set to <code>false</code> and if the page is loaded from <strong>bfcache</strong>, it'll set to <code>true</code>.</p>

<p>I wouldn't really consider this as a solution as it only worked on Safari instead of Chrome or Firefox.</p>

<p>But hey, it gets the job done! &#x1F602;</p>

	</article>
</main>

<script src="/static/vendor/jquery/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="/static/vendor/hljs/js/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-98290003-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-98290003-2');
</script>

<script>
    const darkModeButton = document.createElement('button');
    const syntaxHighlightSource = document.getElementById('syntaxHighlight');
    const menuList = document.querySelector('.menu');
    const themeSettings = {
        "dark": {
            "icon": '<i class="ph-moon-fill"></i>',
            "hljs": "/static/vendor/hljs/css/github-dark.css",
        },
        "light": {
            "icon": '<i class="ph-sun-fill"></i>',
            "hljs": "/static/vendor/hljs/css/github.min.css",
        },
    }

    function highlightMenuLink() {
        var currentURI = window.location.href;
        currentURI = currentURI.replace(window.location.protocol + "//", "");
        var currentPage	 = currentURI.split('/')[1];

        if(currentPage) {
            $('a[href="/' + currentPage + '"').parent().addClass('active');
        }
    }
    
    function initThemeSwitcher() {
        darkModeButton.innerHTML = themeSettings.light.icon;
        darkModeButton.classList.add('darkModeButton');
        
        darkModeButton.addEventListener('click', function(){
            switch(document.documentElement.getAttribute('data-theme')) {
                case 'dark':
                    lightMode();
                    break;

                case 'light':
                default:
                    darkMode();
                    break;
            }
        });
        
        var newItem = document.createElement('li');
        newItem.appendChild(darkModeButton);
        menuList.insertBefore(newItem, menuList.childNodes[menuList.childNodes - 1]);
    }
    

    // Settings for dark mode
    function darkMode() {
        darkModeButton.innerHTML = themeSettings.dark.icon;
        document.documentElement.setAttribute('data-theme', 'dark');
        syntaxHighlightSource.setAttribute('href', themeSettings.dark.hljs);
        localStorage.setItem("theme", "dark");
    }

    // Settings for light mode
    function lightMode() {
        darkModeButton.innerHTML = themeSettings.light.icon;
        document.documentElement.setAttribute('data-theme', '');
        syntaxHighlightSource.setAttribute('href', themeSettings.light.hljs);
        localStorage.setItem("theme", "");
    }

    function checkTheme() {
        const localStorageTheme = localStorage.getItem("theme");
        switch(localStorageTheme) {
            case "dark":
                darkMode();
                break;
            
            default:
                lightMode();
                break;
        }
    }

    // Check if the theme is stored in session
    window.onload = function() {
        initThemeSwitcher();
        checkTheme();
        highlightMenuLink();
    }

    //  open and close nav 
    $('#navbar-toggle').click(function() {
      $('nav ul').slideToggle();
    });

    // Hamburger toggle
    $('#navbar-toggle').on('click', function() {
      this.classList.toggle('active');
    });

    // Click outside the dropdown will remove the dropdown class
    $('html').click(function() {
      $('.navbar-dropdown').hide();
    });
</script>
</body>
</html>